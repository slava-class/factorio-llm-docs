[tools]
# JS runtime for the generator + fetch/unzip orchestration.
bun = "latest"

[tasks.versions]
run = "bun tools/factorio-docs.ts versions"

[tasks.generate]
# Usage: mise run generate -- <target>
# target: latest | stable | <x.y.z>
run = "bun tools/factorio-docs.ts generate --target ${1:-latest}"

[tasks.generate-last5]
# Usage: mise run generate-last5 -- <channel>
# channel: stable | latest
run = "bun tools/factorio-docs.ts generate-last5 --channel ${1:-stable}"

[tasks.generate-all]
# Usage: mise run generate-all
# Generates stable + latest + newest 5 (deduped), then rebuilds llm-docs/index.html.
run = "bun tools/factorio-docs.ts generate-all && bun tools/build-site.ts && bun tools/site-index.ts"

[tasks.setup-smoke-input]
# Usage: mise run setup-smoke-input -- <x.y.z>
# Downloads Factorio API docs input files (runtime/prototype JSON + auxiliary HTML) and caches them under .work/.
run = "bun tools/factorio-docs.ts fetch-input --target ${1:-2.0.72} --out .work/factorio-api-input"

[tasks.smoke]
# Usage: mise run smoke
# Runs generator smoke test against cached inputs (set FACTORIO_SMOKE_VERSION to override).
run = "bun tools/factorio-docs.ts fetch-input --target ${FACTORIO_SMOKE_VERSION:-2.0.72} --out .work/factorio-api-input && FACTORIO_SMOKE_VERSION=${FACTORIO_SMOKE_VERSION:-2.0.72} bun test"

[tasks.smoke-update]
# Usage: mise run smoke-update
# Updates bun snapshots (set FACTORIO_SMOKE_VERSION to override).
run = "bun tools/factorio-docs.ts fetch-input --target ${FACTORIO_SMOKE_VERSION:-2.0.72} --out .work/factorio-api-input && FACTORIO_SMOKE_VERSION=${FACTORIO_SMOKE_VERSION:-2.0.72} bun test --update-snapshots"

[tasks.smoke-clean]
# Usage: mise run smoke-clean -- <x.y.z>
# Removes local smoke output for the given version.
run = "rm -rf .work/factorio-api-input/${1:-${FACTORIO_SMOKE_VERSION:-2.0.72}}/.smoke-out"

[tasks.docs]
# Usage:
# - `mise run docs -- versions`
# - `mise run docs -- search "LuaEntity" --version 2.0.72`
# - `mise run docs -- get "<chunkId>" --version 2.0.72`
# - `mise run docs -- open "runtime/classes/LuaEntity.md" --version 2.0.72`
run = "bun tools/search.ts"
